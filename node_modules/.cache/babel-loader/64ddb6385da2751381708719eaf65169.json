{"ast":null,"code":"import _slicedToArray from \"/home/hugo/workspace/animation/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/hugo/workspace/animation/src/test.js\";\nimport React, { useRef, useState, useLayoutEffect, useEffect } from \"react\";\nimport './App.css';\nexport const Menu = () => {\n  const menuEl = useRef(null);\n  const menuContentsEl = useRef(null);\n  const menuToggleButtonEl = useRef(null);\n  const menuTitleEl = useRef(null);\n\n  const _useState = useState(true),\n        _useState2 = _slicedToArray(_useState, 2),\n        expanded = _useState2[0],\n        setExpanded = _useState2[1];\n\n  const _useState3 = useState(true),\n        _useState4 = _slicedToArray(_useState3, 2),\n        animate = _useState4[0],\n        setAnimate = _useState4[1];\n\n  const _useState5 = useState({\n    x: 0.6607167759029424,\n    y: 0.21787709497206703\n  }),\n        _useState6 = _slicedToArray(_useState5, 2),\n        collapsed = _useState6[0],\n        setCollapsed = _useState6[1];\n\n  useEffect(() => {\n    if (menuToggleButtonEl && menuToggleButtonEl.current) {\n      menuToggleButtonEl.current.addEventListener('click', toggle);\n    } // clean up\n\n\n    return () => menuToggleButtonEl.current.removeEventListener(\"click\", toggle);\n  }, [expanded]);\n\n  const activate = () => {\n    menuEl.current.classList.add('menu--active');\n    setAnimate(true);\n  };\n\n  const expand = () => {\n    console.log('expand function expanded', expanded);\n\n    if (expanded) {\n      return;\n    }\n\n    setExpanded(true);\n    menuEl.current.style.transform = \"scale(1, 1)\";\n    menuContentsEl.current.style.transform = \"scale(1, 1)\";\n\n    if (!animate) {\n      return;\n    }\n\n    applyAnimation({\n      expand: true\n    });\n  };\n\n  const collapse = () => {\n    console.log('collapse function collapsed', collapsed);\n\n    if (!expanded) {\n      return;\n    }\n\n    setExpanded(false);\n    const x = collapsed.x,\n          y = collapsed.y;\n    const invX = 1 / x;\n    const invY = 1 / y;\n    console.log(x, y);\n    menuEl.current.style.transform = \"scale(0, \".concat(y, \")\");\n    menuContentsEl.current.style.transform = \"scale(0, \".concat(invY, \")\");\n\n    if (!animate) {\n      return;\n    }\n\n    applyAnimation({\n      expand: false\n    });\n  };\n\n  const toggle = () => {\n    console.log('toggle function expanded', expanded);\n\n    if (expanded) {\n      collapse();\n      return;\n    }\n\n    console.log('no');\n    expand();\n  };\n\n  const applyAnimation = ({\n    expand\n  }) => {\n    menuEl.current.classList.remove('menu--expanded');\n    menuEl.current.classList.remove('menu--collapsed');\n    menuContentsEl.current.classList.remove('menu__contents--expanded');\n    menuContentsEl.current.classList.remove('menu__contents--collapsed'); // Force a recalc styles here so the classes take hold.\n\n    /* eslint-disable  no-unused-expressions */\n\n    window.getComputedStyle(menuEl.current).transform;\n\n    if (expand) {\n      menuEl.current.classList.add('menu--expanded');\n      menuContentsEl.current.classList.add('menu__contents--expanded');\n      return;\n    }\n\n    menuEl.current.classList.add('menu--collapsed');\n    menuContentsEl.current.classList.add('menu__contents--collapsed');\n  }; // ================== clean =====================\n\n\n  const calculateScales = () => {\n    const collapsedBounding = menuTitleEl.current.getBoundingClientRect();\n    const expandedBounding = menuEl.current.getBoundingClientRect();\n    setCollapsed(true);\n    return {\n      x: collapsedBounding.width / expandedBounding.width,\n      y: collapsedBounding.height / expandedBounding.height\n    };\n  };\n\n  const createEaseAnimations = scales => {\n    let menuEase = document.querySelector('.menu-ease');\n\n    if (menuEase) {\n      return menuEase;\n    }\n\n    menuEase = document.createElement('style');\n    menuEase.classList.add('menu-ease');\n    const menuExpandAnimation = [];\n    const menuExpandContentsAnimation = [];\n    const menuCollapseAnimation = [];\n    const menuCollapseContentsAnimation = [];\n\n    for (let i = 0; i <= 100; i++) {\n      const step = _ease(i / 100);\n\n      console.log(collapsed);\n      const startX = scales.x;\n      const startY = scales.y;\n      const endX = 1;\n      const endY = 1; // Expand animation.\n\n      append({\n        i,\n        step,\n        startX: scales.x,\n        startY: scales.y,\n        endX: 1,\n        endY: 1,\n        outerAnimation: menuExpandAnimation,\n        innerAnimation: menuExpandContentsAnimation\n      }); // Collapse animation.\n\n      append({\n        i,\n        step,\n        startX: 1,\n        startY: 1,\n        endX: scales.x,\n        endY: scales.y,\n        outerAnimation: menuCollapseAnimation,\n        innerAnimation: menuCollapseContentsAnimation\n      });\n    }\n\n    menuEase.textContent = \"\\n      @keyframes menuExpandAnimation {\\n        \".concat(menuExpandAnimation.join(''), \"\\n      }\\n\\n      @keyframes menuExpandContentsAnimation {\\n        \").concat(menuExpandContentsAnimation.join(''), \"\\n      }\\n      \\n      @keyframes menuCollapseAnimation {\\n        \").concat(menuCollapseAnimation.join(''), \"\\n      }\\n\\n      @keyframes menuCollapseContentsAnimation {\\n        \").concat(menuCollapseContentsAnimation.join(''), \"\\n      }\");\n    document.head.appendChild(menuEase);\n    return menuEase;\n  };\n\n  const append = ({\n    i,\n    step,\n    startX,\n    startY,\n    endX,\n    endY,\n    outerAnimation,\n    innerAnimation\n  }) => {\n    const xScale = startX + (endX - startX) * step;\n    const yScale = startY + (endY - startY) * step;\n    const invScaleX = 1 / xScale;\n    const invScaleY = 1 / yScale;\n    outerAnimation.push(\"\\n      \".concat(i, \"% {\\n        transform: scale(\").concat(xScale, \", \").concat(yScale, \");\\n      }\"));\n    innerAnimation.push(\"\\n      \".concat(i, \"% {\\n        transform: scale(\").concat(invScaleX, \", \").concat(invScaleY, \");\\n      }\"));\n  };\n\n  const clamp = (value, min, max) => {\n    return Math.max(min, Math.min(max, value));\n  };\n\n  const _ease = (v, pow = 4) => {\n    v = clamp(v, 0, 1);\n    return 1 - Math.pow(1 - v, pow);\n  };\n\n  ;\n  useLayoutEffect(() => {\n    const scales = calculateScales();\n    setCollapsed(scales);\n    createEaseAnimations(scales); // collapse();\n\n    activate();\n  }, []);\n  console.log('state', {\n    collapsed,\n    expanded,\n    animate\n  });\n  return React.createElement(\"nav\", {\n    ref: menuEl,\n    className: \"menu js-menu \".concat(animate && 'menu--active'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    ref: menuContentsEl,\n    className: \"menu__contents js-menu-contents\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    ref: menuToggleButtonEl,\n    className: \"menu__toggle js-menu-toggle\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232\n    },\n    __self: this\n  }, React.createElement(\"h1\", {\n    ref: menuTitleEl,\n    className: \"menu__title js-menu-title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233\n    },\n    __self: this\n  }, \"Menu\")), React.createElement(\"ul\", {\n    className: \"menu__items\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    className: \"menu__item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236\n    },\n    __self: this\n  }, \"Menu item 1\"), React.createElement(\"li\", {\n    className: \"menu__item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237\n    },\n    __self: this\n  }, \"Menu item 2\"), React.createElement(\"li\", {\n    className: \"menu__item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238\n    },\n    __self: this\n  }, \"Menu item 3\"), React.createElement(\"li\", {\n    className: \"menu__item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239\n    },\n    __self: this\n  }, \"Menu item 4\"))));\n};\nexport default Menu;","map":{"version":3,"sources":["/home/hugo/workspace/animation/src/test.js"],"names":["React","useRef","useState","useLayoutEffect","useEffect","Menu","menuEl","menuContentsEl","menuToggleButtonEl","menuTitleEl","expanded","setExpanded","animate","setAnimate","x","y","collapsed","setCollapsed","current","addEventListener","toggle","removeEventListener","activate","classList","add","expand","console","log","style","transform","applyAnimation","collapse","invX","invY","remove","window","getComputedStyle","calculateScales","collapsedBounding","getBoundingClientRect","expandedBounding","width","height","createEaseAnimations","scales","menuEase","document","querySelector","createElement","menuExpandAnimation","menuExpandContentsAnimation","menuCollapseAnimation","menuCollapseContentsAnimation","i","step","_ease","startX","startY","endX","endY","append","outerAnimation","innerAnimation","textContent","join","head","appendChild","xScale","yScale","invScaleX","invScaleY","push","clamp","value","min","max","Math","v","pow"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useLayoutEffect, useEffect } from \"react\";\nimport './App.css'\n\nexport const Menu = () => {\n    const menuEl = useRef(null);\n    const menuContentsEl = useRef(null);\n    const menuToggleButtonEl = useRef(null);\n    const menuTitleEl = useRef(null);\n    const [expanded, setExpanded] = useState(true);\n    const [animate, setAnimate] = useState(true);\n    const [collapsed, setCollapsed] = useState({ x: 0.6607167759029424, y: 0.21787709497206703 });\n\n    useEffect(() => {\n        if (menuToggleButtonEl && menuToggleButtonEl.current) {\n        menuToggleButtonEl.current.addEventListener('click', toggle);\n        }\n\n        // clean up\n        return () => menuToggleButtonEl.current.removeEventListener(\"click\", toggle);\n    }, [expanded]);\n\n    const activate = () => {\n        menuEl.current.classList.add('menu--active');\n        setAnimate(true);\n    }\n\n    const expand = () => {\n        console.log('expand function expanded', expanded);\n        if (expanded) {\n            return;\n        }\n\n        setExpanded(true);\n\n        menuEl.current.style.transform = `scale(1, 1)`;\n        menuContentsEl.current.style.transform = `scale(1, 1)`;\n\n        if (!animate) {\n            return;\n        }\n\n        applyAnimation({expand: true});\n    };\n\n    const collapse = () => {\n\n        console.log('collapse function collapsed', collapsed);\n        if (!expanded) {\n            return;\n        }\n        setExpanded(false);\n\n        const {x, y} = collapsed;\n        const invX = 1 / x;\n        const invY = 1 / y;\n\n        console.log(x, y);\n        menuEl.current.style.transform = `scale(0, ${y})`;\n        menuContentsEl.current.style.transform = `scale(0, ${invY})`;\n\n        if (!animate) {\n            return;\n        }\n\n        applyAnimation({expand: false});\n    }\n\n    const toggle = () => {\n        console.log('toggle function expanded', expanded);\n        if (expanded) {\n            collapse();\n            return;\n        }\n        console.log('no');\n        expand();\n    };\n\n    const applyAnimation = ({ expand }) => {\n        menuEl.current.classList.remove('menu--expanded');\n        menuEl.current.classList.remove('menu--collapsed');\n        menuContentsEl.current.classList.remove('menu__contents--expanded');\n        menuContentsEl.current.classList.remove('menu__contents--collapsed');\n\n        // Force a recalc styles here so the classes take hold.\n        /* eslint-disable  no-unused-expressions */\n        window.getComputedStyle(menuEl.current).transform;\n\n        if (expand) {\n            menuEl.current.classList.add('menu--expanded');\n            menuContentsEl.current.classList.add('menu__contents--expanded');\n            return;\n        }\n\n        menuEl.current.classList.add('menu--collapsed');\n        menuContentsEl.current.classList.add('menu__contents--collapsed');\n    }\n\n    // ================== clean =====================\n    const calculateScales = () => {\n        const collapsedBounding = menuTitleEl.current.getBoundingClientRect();\n        const expandedBounding = menuEl.current.getBoundingClientRect();\n        setCollapsed(true);\n\n        return {\n            x: collapsedBounding.width / expandedBounding.width,\n            y: collapsedBounding.height / expandedBounding.height\n        }\n    };\n\n    const createEaseAnimations = (scales) => {\n        let menuEase = document.querySelector('.menu-ease');\n        if (menuEase) {\n            return menuEase;\n        }\n\n        menuEase = document.createElement('style');\n        menuEase.classList.add('menu-ease');\n\n        const menuExpandAnimation = [];\n        const menuExpandContentsAnimation = [];\n        const menuCollapseAnimation = [];\n        const menuCollapseContentsAnimation = [];\n        for (let i = 0; i <= 100; i++) {\n            const step = _ease(i/100);\n            console.log(collapsed);\n            const startX = scales.x;\n            const startY = scales.y;\n            const endX = 1;\n            const endY = 1;\n\n            // Expand animation.\n            append({\n                i,\n                step,\n                startX: scales.x,\n                startY: scales.y,\n                endX: 1,\n                endY: 1,\n                outerAnimation: menuExpandAnimation,\n                innerAnimation: menuExpandContentsAnimation\n            });\n\n            // Collapse animation.\n            append({\n                i,\n                step,\n                startX: 1,\n                startY: 1,\n                endX: scales.x,\n                endY: scales.y,\n                outerAnimation: menuCollapseAnimation,\n                innerAnimation: menuCollapseContentsAnimation\n            });\n        }\n\n        menuEase.textContent = `\n      @keyframes menuExpandAnimation {\n        ${menuExpandAnimation.join('')}\n      }\n\n      @keyframes menuExpandContentsAnimation {\n        ${menuExpandContentsAnimation.join('')}\n      }\n      \n      @keyframes menuCollapseAnimation {\n        ${menuCollapseAnimation.join('')}\n      }\n\n      @keyframes menuCollapseContentsAnimation {\n        ${menuCollapseContentsAnimation.join('')}\n      }`;\n\n        document.head.appendChild(menuEase);\n        return menuEase;\n    };\n\n    const append = ({\n                        i,\n                        step,\n                        startX,\n                        startY,\n                        endX,\n                        endY,\n                        outerAnimation,\n                        innerAnimation}) => {\n\n        const xScale = startX + (endX - startX) * step;\n        const yScale = startY + (endY - startY) * step;\n\n        const invScaleX = 1 / xScale;\n        const invScaleY = 1 / yScale;\n\n        outerAnimation.push(`\n      ${i}% {\n        transform: scale(${xScale}, ${yScale});\n      }`);\n\n        innerAnimation.push(`\n      ${i}% {\n        transform: scale(${invScaleX}, ${invScaleY});\n      }`);\n    };\n\n    const clamp = (value, min, max) => {\n        return Math.max(min, Math.min(max, value));\n    };\n\n    const _ease  = (v, pow=4) => {\n        v = clamp(v, 0, 1);\n\n        return 1 - Math.pow(1 - v, pow);\n    };;\n\n    useLayoutEffect(() => {\n        const scales = calculateScales();\n        setCollapsed(scales);\n        createEaseAnimations(scales);\n        // collapse();\n        activate();\n\n    }, []);\n\n    console.log('state',\n        {\n            collapsed,\n            expanded,\n            animate,\n        });\n    return (\n        <nav ref={menuEl} className={`menu js-menu ${animate && 'menu--active'}`}>\n            <div ref={menuContentsEl} className=\"menu__contents js-menu-contents\">\n                <button ref={menuToggleButtonEl} className=\"menu__toggle js-menu-toggle\">\n                    <h1 ref={menuTitleEl} className=\"menu__title js-menu-title\">Menu</h1>\n                </button>\n                <ul className=\"menu__items\">\n                    <li className=\"menu__item\">Menu item 1</li>\n                    <li className=\"menu__item\">Menu item 2</li>\n                    <li className=\"menu__item\">Menu item 3</li>\n                    <li className=\"menu__item\">Menu item 4</li>\n                </ul>\n            </div>\n        </nav>\n    );\n};\n\nexport default Menu;\n"]},"metadata":{},"sourceType":"module"}