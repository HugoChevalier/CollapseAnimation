{"ast":null,"code":"import _slicedToArray from \"/home/hugo/workspace/animation/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/hugo/workspace/animation/src/test.js\";\nimport React, { useRef, useState, useLayoutEffect, useEffect } from \"react\";\nimport './App.css';\nexport const Menu = ({\n  setNeedToResize\n}) => {\n  const menuEl = useRef(null);\n  const menuContentsEl = useRef(null);\n  const menuToggleButtonEl = useRef(null);\n  const menuTitleEl = useRef(null);\n\n  const _useState = useState(true),\n        _useState2 = _slicedToArray(_useState, 2),\n        expanded = _useState2[0],\n        setExpanded = _useState2[1];\n\n  const _useState3 = useState(true),\n        _useState4 = _slicedToArray(_useState3, 2),\n        animate = _useState4[0],\n        setAnimate = _useState4[1];\n\n  const _useState5 = useState(null),\n        _useState6 = _slicedToArray(_useState5, 2),\n        collapsed = _useState6[0],\n        setCollapsed = _useState6[1];\n\n  useEffect(() => {\n    if (menuToggleButtonEl && menuToggleButtonEl.current) {\n      menuToggleButtonEl.current.addEventListener('click', toggle);\n    } // clean up\n\n\n    return () => menuToggleButtonEl.current.removeEventListener(\"click\", toggle);\n  }, [expanded]);\n\n  const activate = () => {\n    menuEl.current.classList.add('menu--active');\n    setAnimate(true);\n  };\n\n  const expand = () => {\n    console.log('expand function expanded', expanded);\n\n    if (expanded) {\n      return;\n    }\n\n    setExpanded(true);\n    menuEl.current.style.transform = \"scale(1, 1)\";\n    menuContentsEl.current.style.transform = \"scale(1, 1)\";\n\n    if (!animate) {\n      return;\n    }\n\n    applyAnimation({\n      expand: true\n    });\n  };\n\n  const collapse = (scales = collapsed) => {\n    if (!expanded) {\n      return;\n    }\n\n    setExpanded(false);\n    const y = scales.y;\n    const invY = 1 / y;\n    menuEl.current.style.transform = \"scale(1, \".concat(y, \")\");\n    menuContentsEl.current.style.transform = \"scale(1, \".concat(invY, \")\");\n\n    if (!animate) {\n      return;\n    }\n\n    applyAnimation({\n      expand: false\n    });\n  };\n\n  const toggle = () => {\n    if (expanded) {\n      collapse();\n      return;\n    }\n\n    expand();\n  };\n\n  const applyAnimation = ({\n    expand\n  }) => {\n    menuEl.current.classList.remove('menu--expanded');\n    menuEl.current.classList.remove('menu--collapsed');\n    menuContentsEl.current.classList.remove('menu__contents--expanded');\n    menuContentsEl.current.classList.remove('menu__contents--collapsed'); // Force a recalc styles here so the classes take hold.\n\n    /* eslint-disable  no-unused-expressions */\n\n    window.getComputedStyle(menuEl.current).transform;\n\n    if (expand) {\n      menuEl.current.classList.add('menu--expanded');\n      menuContentsEl.current.classList.add('menu__contents--expanded');\n      return;\n    }\n\n    menuEl.current.classList.add('menu--collapsed');\n    menuContentsEl.current.classList.add('menu__contents--collapsed');\n    setNeedToResize(true);\n  }; // ================== clean =====================\n\n\n  const calculateScales = () => {\n    const collapsedBounding = menuTitleEl.current.getBoundingClientRect();\n    const expandedBounding = menuEl.current.getBoundingClientRect();\n    setCollapsed({\n      x: collapsedBounding.width / expandedBounding.width,\n      y: collapsedBounding.height / expandedBounding.height\n    });\n    return {\n      x: collapsedBounding.width / expandedBounding.width,\n      y: collapsedBounding.height / expandedBounding.height\n    };\n  };\n\n  const createEaseAnimations = scales => {\n    let menuEase = document.querySelector('.menu-ease');\n\n    if (menuEase) {\n      return menuEase;\n    }\n\n    menuEase = document.createElement('style');\n    menuEase.classList.add('menu-ease');\n    const menuExpandAnimation = [];\n    const menuExpandContentsAnimation = [];\n    const menuCollapseAnimation = [];\n    const menuCollapseContentsAnimation = [];\n\n    for (let i = 0; i <= 100; i++) {\n      const step = _ease(i / 100); // Expand animation.\n\n\n      append({\n        i,\n        step,\n        startY: scales.y,\n        endY: 1,\n        outerAnimation: menuExpandAnimation,\n        innerAnimation: menuExpandContentsAnimation\n      }); // Collapse animation.\n\n      append({\n        i,\n        step,\n        startY: 1,\n        endY: scales.y,\n        outerAnimation: menuCollapseAnimation,\n        innerAnimation: menuCollapseContentsAnimation\n      });\n    }\n\n    menuEase.textContent = \"\\n      @keyframes menuExpandAnimation {\\n        \".concat(menuExpandAnimation.join(''), \"\\n      }\\n\\n      @keyframes menuExpandContentsAnimation {\\n        \").concat(menuExpandContentsAnimation.join(''), \"\\n      }\\n      \\n      @keyframes menuCollapseAnimation {\\n        \").concat(menuCollapseAnimation.join(''), \"\\n      }\\n\\n      @keyframes menuCollapseContentsAnimation {\\n        \").concat(menuCollapseContentsAnimation.join(''), \"\\n      }\");\n    document.head.appendChild(menuEase);\n    return menuEase;\n  };\n\n  const append = ({\n    i,\n    step,\n    startY,\n    endY,\n    outerAnimation,\n    innerAnimation\n  }) => {\n    const yScale = startY + (endY - startY) * step;\n    const invScaleY = 1 / yScale;\n    outerAnimation.push(\"\\n      \".concat(i, \"% {\\n        transform: scale(1, \").concat(yScale, \");\\n      }\"));\n    innerAnimation.push(\"\\n      \".concat(i, \"% {\\n        transform: scale(1, \").concat(invScaleY, \");\\n      }\"));\n  };\n\n  const clamp = (value, min, max) => {\n    return Math.max(min, Math.min(max, value));\n  };\n\n  const _ease = (v, pow = 4) => {\n    v = clamp(v, 0, 1);\n    return 1 - Math.pow(1 - v, pow);\n  };\n\n  ;\n  useLayoutEffect(() => {\n    const scales = calculateScales();\n    setCollapsed(scales);\n    createEaseAnimations(scales);\n    collapse(scales);\n    activate();\n  }, []);\n  return React.createElement(\"nav\", {\n    ref: menuEl,\n    className: \"menu js-menu \".concat(animate && 'menu--active'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    ref: menuContentsEl,\n    className: \"menu__contents js-menu-contents\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    ref: menuToggleButtonEl,\n    className: \"menu__toggle js-menu-toggle\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211\n    },\n    __self: this\n  }, React.createElement(\"h1\", {\n    ref: menuTitleEl,\n    className: \"menu__title js-menu-title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212\n    },\n    __self: this\n  }, \"Menu\")), React.createElement(\"ul\", {\n    className: \"menu__items\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    className: \"menu__item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215\n    },\n    __self: this\n  }, \"Menu item 1\"), React.createElement(\"li\", {\n    className: \"menu__item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216\n    },\n    __self: this\n  }, \"Menu item 2\"), React.createElement(\"li\", {\n    className: \"menu__item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217\n    },\n    __self: this\n  }, \"Menu item 3\"), React.createElement(\"li\", {\n    className: \"menu__item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218\n    },\n    __self: this\n  }, \"Menu item 4\"))));\n};\nexport default Menu;","map":{"version":3,"sources":["/home/hugo/workspace/animation/src/test.js"],"names":["React","useRef","useState","useLayoutEffect","useEffect","Menu","setNeedToResize","menuEl","menuContentsEl","menuToggleButtonEl","menuTitleEl","expanded","setExpanded","animate","setAnimate","collapsed","setCollapsed","current","addEventListener","toggle","removeEventListener","activate","classList","add","expand","console","log","style","transform","applyAnimation","collapse","scales","y","invY","remove","window","getComputedStyle","calculateScales","collapsedBounding","getBoundingClientRect","expandedBounding","x","width","height","createEaseAnimations","menuEase","document","querySelector","createElement","menuExpandAnimation","menuExpandContentsAnimation","menuCollapseAnimation","menuCollapseContentsAnimation","i","step","_ease","append","startY","endY","outerAnimation","innerAnimation","textContent","join","head","appendChild","yScale","invScaleY","push","clamp","value","min","max","Math","v","pow"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useLayoutEffect, useEffect } from \"react\";\nimport './App.css'\n\nexport const Menu = ({ setNeedToResize }) => {\n    const menuEl = useRef(null);\n    const menuContentsEl = useRef(null);\n    const menuToggleButtonEl = useRef(null);\n    const menuTitleEl = useRef(null);\n    const [expanded, setExpanded] = useState(true);\n    const [animate, setAnimate] = useState(true);\n    const [collapsed, setCollapsed] = useState(null);\n\n    useEffect(() => {\n        if (menuToggleButtonEl && menuToggleButtonEl.current) {\n        menuToggleButtonEl.current.addEventListener('click', toggle);\n        }\n\n        // clean up\n        return () => menuToggleButtonEl.current.removeEventListener(\"click\", toggle);\n    }, [expanded]);\n\n    const activate = () => {\n        menuEl.current.classList.add('menu--active');\n        setAnimate(true);\n    }\n\n    const expand = () => {\n        console.log('expand function expanded', expanded);\n        if (expanded) {\n            return;\n        }\n\n        setExpanded(true);\n\n        menuEl.current.style.transform = `scale(1, 1)`;\n        menuContentsEl.current.style.transform = `scale(1, 1)`;\n\n        if (!animate) {\n            return;\n        }\n\n        applyAnimation({expand: true});\n    };\n\n    const collapse = (scales = collapsed) => {\n        if (!expanded) {\n            return;\n        }\n        setExpanded(false);\n\n        const { y } = scales;\n        const invY = 1 / y;\n\n        menuEl.current.style.transform = `scale(1, ${y})`;\n        menuContentsEl.current.style.transform = `scale(1, ${invY})`;\n\n        if (!animate) {\n            return;\n        }\n\n        applyAnimation({expand: false});\n    }\n\n    const toggle = () => {\n        if (expanded) {\n            collapse();\n            return;\n        }\n        expand();\n    };\n\n    const applyAnimation = ({ expand }) => {\n        menuEl.current.classList.remove('menu--expanded');\n        menuEl.current.classList.remove('menu--collapsed');\n        menuContentsEl.current.classList.remove('menu__contents--expanded');\n        menuContentsEl.current.classList.remove('menu__contents--collapsed');\n\n        // Force a recalc styles here so the classes take hold.\n        /* eslint-disable  no-unused-expressions */\n        window.getComputedStyle(menuEl.current).transform;\n\n        if (expand) {\n            menuEl.current.classList.add('menu--expanded');\n            menuContentsEl.current.classList.add('menu__contents--expanded');\n            return;\n        }\n\n        menuEl.current.classList.add('menu--collapsed');\n        menuContentsEl.current.classList.add('menu__contents--collapsed');\n        setNeedToResize(true);\n    }\n\n    // ================== clean =====================\n    const calculateScales = () => {\n        const collapsedBounding = menuTitleEl.current.getBoundingClientRect();\n        const expandedBounding = menuEl.current.getBoundingClientRect();\n        setCollapsed({\n            x: collapsedBounding.width / expandedBounding.width,\n            y: collapsedBounding.height / expandedBounding.height\n        });\n\n        return {\n            x: collapsedBounding.width / expandedBounding.width,\n            y: collapsedBounding.height / expandedBounding.height\n        }\n    };\n\n    const createEaseAnimations = (scales) => {\n        let menuEase = document.querySelector('.menu-ease');\n        if (menuEase) {\n            return menuEase;\n        }\n\n        menuEase = document.createElement('style');\n        menuEase.classList.add('menu-ease');\n\n        const menuExpandAnimation = [];\n        const menuExpandContentsAnimation = [];\n        const menuCollapseAnimation = [];\n        const menuCollapseContentsAnimation = [];\n        for (let i = 0; i <= 100; i++) {\n            const step = _ease(i/100);\n\n            // Expand animation.\n            append({\n                i,\n                step,\n                startY: scales.y,\n                endY: 1,\n                outerAnimation: menuExpandAnimation,\n                innerAnimation: menuExpandContentsAnimation\n            });\n\n            // Collapse animation.\n            append({\n                i,\n                step,\n                startY: 1,\n                endY: scales.y,\n                outerAnimation: menuCollapseAnimation,\n                innerAnimation: menuCollapseContentsAnimation\n            });\n        }\n\n        menuEase.textContent = `\n      @keyframes menuExpandAnimation {\n        ${menuExpandAnimation.join('')}\n      }\n\n      @keyframes menuExpandContentsAnimation {\n        ${menuExpandContentsAnimation.join('')}\n      }\n      \n      @keyframes menuCollapseAnimation {\n        ${menuCollapseAnimation.join('')}\n      }\n\n      @keyframes menuCollapseContentsAnimation {\n        ${menuCollapseContentsAnimation.join('')}\n      }`;\n\n        document.head.appendChild(menuEase);\n        return menuEase;\n    };\n\n    const append = ({\n                        i,\n                        step,\n                        startY,\n                        endY,\n                        outerAnimation,\n                        innerAnimation}) => {\n\n        const yScale = startY + (endY - startY) * step;\n\n        const invScaleY = 1 / yScale;\n\n        outerAnimation.push(`\n      ${i}% {\n        transform: scale(1, ${yScale});\n      }`);\n\n        innerAnimation.push(`\n      ${i}% {\n        transform: scale(1, ${invScaleY});\n      }`);\n    };\n\n    const clamp = (value, min, max) => {\n        return Math.max(min, Math.min(max, value));\n    };\n\n    const _ease  = (v, pow=4) => {\n        v = clamp(v, 0, 1);\n\n        return 1 - Math.pow(1 - v, pow);\n    };;\n\n    useLayoutEffect(() => {\n        const scales = calculateScales();\n        setCollapsed(scales);\n        createEaseAnimations(scales);\n        collapse(scales);\n        activate();\n\n    }, []);\n\n    return (\n        <nav ref={menuEl} className={`menu js-menu ${animate && 'menu--active'}`}>\n            <div ref={menuContentsEl} className=\"menu__contents js-menu-contents\">\n                <button ref={menuToggleButtonEl} className=\"menu__toggle js-menu-toggle\">\n                    <h1 ref={menuTitleEl} className=\"menu__title js-menu-title\">Menu</h1>\n                </button>\n                <ul className=\"menu__items\">\n                    <li className=\"menu__item\">Menu item 1</li>\n                    <li className=\"menu__item\">Menu item 2</li>\n                    <li className=\"menu__item\">Menu item 3</li>\n                    <li className=\"menu__item\">Menu item 4</li>\n                </ul>\n            </div>\n        </nav>\n    );\n};\n\nexport default Menu;\n"]},"metadata":{},"sourceType":"module"}